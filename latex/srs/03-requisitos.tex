\section{Requisitos de interfaces externas}

\section{Requisitos funcionales}

\subsection{Registrarse}

{\footnotesize
\begin{tabularx}{0.95\textwidth}{p{0.2\textwidth}|X}

\textbf{Caso de uso} & Registrarse \\

\textbf{Precondición} & Ninguna \\

\textbf{Escenario general} & \begin{enumerate}
\item El usuario selecciona registrarse en la ventana de inicio.
\item La ventana principal muestra la ventana de registro.
\item El usuario introduce sus datos en la ventana de registro.
\item La ventana de registro verifica que los datos sean válidos y no habilita
el botón de confirmación hasta que lo sean.
\item El usuario pulsa el botón de confirmación.
\item La ventana de registro pide al gestor de usuarios que cree un nuevo
jugador con los datos indicados.
\item El gestor de usuarios pide al servidor que cree un nuevo jugador mediante
el proxy.
\item El servidor confirma al gestor de usuarios la creación del jugador.
\item La ventana de inicio informa al usuario del éxito de la operación.
\end{enumerate} \\

\textbf{Poscondición} & Un nuevo usuario existe en el sistema.

\end{tabularx}
}

\subsection{Iniciar sesión}

{\footnotesize
\begin{tabularx}{0.95\textwidth}{p{0.2\textwidth}|X}

\textbf{Caso de uso} & Iniciar sesión \\

\textbf{Precondición} & Usuario registrado \\

\textbf{Escenario general} & \begin{enumerate}
\item El usuario introduce su nombre y contraseña en la ventana de inicio.
\item La ventana de inicio verfica la validez de los datos.
\item El usuario pulsa el botón ``Iniciar sesión''.
\item El gestor de usuarios pide al servidor que valide al usuario.
\item El servidor confirma al gestor de usuarios que el usuario es válido.
\item El gestor de usuarios crea una sesión.
\item Se cierra la ventana de inicio y se abre la ventana principal.
\end{enumerate} \\

\textbf{Poscondición} & Ninguna \\ \\

\textbf{Escenario alternativo} & Puede ocurrir que los datos de acceso no sean
correctos, en cuyo caso se aborta la operación y se vuelve al estado inicial.

\end{tabularx}
}

\subsection{Cerrar sesión}

{\footnotesize
\begin{tabularx}{0.95\textwidth}{p{0.2\textwidth}|X}

\textbf{Caso de uso} & Cerrar sesión \\

\textbf{Precondición} & Sesión iniciada \\

\textbf{Escenario general} & \begin{enumerate}
\item El usuario pulsa el botón ``Cerrar sesión'' en la ventana principal.
\item La ventana principal pide al gestor de usuarios que cierre la sesión.
\item El gestor de usuarios pide al servidor que cierre la sesión.
\item El servidor comunica al gestor de usuarios que ha cerrado la sesión.
\item Se cierra la ventana principal y se abre la ventana de inicio.
\end{enumerate} \\

\textbf{Poscondición} & El usuario deja de estar activo en el servidor.

\end{tabularx}
}

\subsection{Crear una nueva partida}
{\footnotesize
\begin{tabularx}{0.95\textwidth}{p{0.2\textwidth}|X}

\textbf{Caso de uso} & Crear una nueva partida \\

\textbf{Precondición} & El usuario debe estar logeado \\

\textbf{Escenario general} & \begin{enumerate}
\item El usuario selecciona de la ventana de juego crear una nueva partida.
\item La ventana de juego muestra la ventana de crear partida.
\item El usuario selecciona las características de la partida.
\item La ventana crear partida habilita el botón \emph{crear} cuando los datos
son correctos.
\item El usuario pulsa el botón crear.
\item La ventana crear partida notifica al gestor de partidas que un usuario
desea crear una partida.
\item El gestor de partidas pide al servidor mediante el proxy que cree una
partida.
\item El proxy le indica al gestor de partidas que se ha creado una nueva
partida.
\item El gestor modifica la ventana de juego con el nuevo estado de las
partidas.
\item La ventana de juego oculta la ventana de crear partidas.
\item La ventana principal comunica al jugador que se ha creado una nueva
partida.
\end{enumerate} \\

\textbf{Poscondición} & En el sistema hay una nueva partida y se ejecuta el caso
 de uso ``Unirse a partida''.\\ \\

\textbf{Escenario alternativo} & \begin{enumerate}
\item El usuario selecciona de la ventana de juego crear una nueva partida.
\item La ventana de juego muestra la ventana de crear partida.
\item El usuario selecciona las características de la partida.
\item La ventana crear partida habilita el botón \emph{crear} cuando los datos
son correctos.
\item El usuario pulsa el botón crear.
\item La ventana crear partida notifica al gestor de partidas que un usuario
desea crear una partida.
\item El gestor de partidas pide al servidor mediante el proxy que cree una
partida.
\item El proxy le indica al gestor de partidas que no se ha podido crear la
partida.
\item La ventana de juego oculta la ventana de crear partidas.
\item La ventana principal comunica al jugador que no se ha podido crear la
partida.
\end{enumerate} \\

\end{tabularx}
}


\subsection{Unirse a una partida}
{\footnotesize
\begin{tabularx}{0.95\textwidth}{p{0.2\textwidth}|X}

\textbf{Caso de uso} & Unirse a partida \\

\textbf{Precondición} & El usuario debe estar logeado \\

\textbf{Escenario general} & \begin{enumerate}
\item El usuario selecciona de la lista de partidas disponibles de la ventana de
juego.
\item La ventana notifica al gestor de usuario que el usuario desea unirse a la
partida seleccionada.
\item El gestor de usuarios se comunica con el servidor para indicarle que un
usuario quiere unirse a una partida mediante el proxy.
\item El proxy notifica al gestor que el usuario se ha unido a la partida.
\item El gestor de usuarios actualiza la lista de partidas del jugador.
\item El gestor modifica la ventana de juego con el nuevo estado de las
partidas.
\end{enumerate} \\

\textbf{Poscondición} & En la partida seleccionada hay un nuevo jugador y se
ejecuta el caso de uso ``Conectarse a una partida''.\\

\textbf{Escenario alternativo} & \begin{enumerate}
\item El usuario selecciona de la lista de partidas disponibles de la ventana de
juego.
\item La ventana notifica al gestor de usuario que el usuario desea unirse a la
partida seleccionada.
\item El gestor de usuarios se comunica con el servidor para indicarle que un
usuario quiere unirse a una partida mediante el proxy.
\item El proxy notifica al gestor que el usuario no se ha podido unir a la
partida ya que no hay sitio disponible.
\item El gestor de usuarios actualiza la lista de partidas disponibles.
\item El gestor modifica la ventana con el nuevo estado de las partidas.
\end{enumerate}

\end{tabularx}
}

\subsection{Conectarse a una partida}
{\footnotesize
\begin{tabularx}{0.95\textwidth}{p{0.2\textwidth}|X}

\textbf{Caso de uso} & Conectarse a una partida \\

\textbf{Precondición} & El jugador debe haber iniciado sesión y haberse unido a
la partida.\\

\textbf{Escenario general} & \begin{enumerate}
\item El usuario selecciona una partida dentro de la lista de partidas a las que
se ha unido ese usuario.
\item La ventana principal pide al gestor de partidas que inicie la partida
seleccionada.
\item El gestor de partidas pide al servidor la información de la partida
solicitada mediante el proxy.
\item El servidor envia la información correspondiente de la partida indicada al
gestor de partidas.
\item El gestor de partidas abre la nueva ventana de juego con la información
recibida de la partida.

\end{enumerate} \\

\textbf{Poscondición}

\end{tabularx}
}

\subsection{Desconectarse de una partida}
{\footnotesize
\begin{tabularx}{0.95\textwidth}{p{0.2\textwidth}|X}

\textbf{Caso de uso} & Desconectarse de una partida \\

\textbf{Precondición} & Estar conectado a una partida.\\

\textbf{Escenario general} & \begin{enumerate}
\item El usuario pulsa el botón cerrar partida en la ventana de juego.
\item La ventana de juego le indica al gestor de partidas que cierre la partida
en juego.
\item El gestor de partidas comunica al servidor el estado de la partida.
\item Se cierra la ventana de juego y se muestra la ventana principal.

\end{enumerate} \\

\textbf{Poscondición} & Se sale de la partida y aparece la ventana principal.

\end{tabularx}
}

\subsection{Ver la lista de partidas}

{\footnotesize
\begin{tabularx}{0.95\textwidth}{p{0.2\textwidth}|X}

\textbf{Caso de uso} & Ver la lista de partidas \\

\textbf{Precondición} & Iniciar sesión \\

\textbf{Escenario general} & \begin{enumerate}
\item La ventana principal pide al gestor de partidas una lista con las
partidas libres disponibles y una lista con las partidas que el usuario esta
jugando.
\item El gestor de partidas pide al servidor ambas listas.
\item El servidor envía ambas listas de partidas al gestor de partidas.
\item La ventana principal muestra la lista de partidas disponibles y la lista
de partidas comenzadas.

\end{enumerate} \\

\textbf{Poscondición} & La lista de partidas esta disponible para el usuario.

\end{tabularx}
}

\subsection{Recibir notificación de un nuevo jugador}

{\footnotesize
\begin{tabularx}{0.95\textwidth}{p{0.2\textwidth}|X}

\textbf{Caso de uso} & Recibir notificación de un nuevo jugador \\

\textbf{Precondición} & Para recibir notificaciones cuando un jugador se une a
una partida, es necesario que el jugador que quiere recibirlas esté unido a la
partida y logueado. \\

\textbf{Escenario general} & El jugador está conectado en el sistema jugando a
esta partida.\begin{enumerate}

\item El servidor envia al gestor de partidas el nombre del nuevo jugador y la
partida a la que se quiere conectar.
\item El gestor de usuarios pasa esta información a la ventana de la partida.
\item La ventana de la partida muestra un mensaje indicando: ``El jugador X se
ha conectado a la partida Y''.

\end{enumerate} \\

\textbf{Poscondición} & Se realiza el caso de uso: ''Recibir actualización de la
partida''. \\ \\

\textbf{Escenario alternativo} & El jugador está conectado en el sistema jugando
a otra partida. En este caso no se realia la poscondición.

% En el caso de que el usuario no esté conectado, la aplicación cliente no tiene
% que hacer nada, es el servidor el que tiene que enviar un correo electrónico
% al usuario.

% LAURA ???
%\textbf{Escenario general} & \begin{enumerate}
%\item
%TODO {``Bifurcación" del caso de uso}

%\end{enumerate} \\

%\textbf{Poscondición} & La lista de partidas esta disponible para el usuario.
%%%

\end{tabularx}
}

\subsection{Realizar un movimiento}

{\footnotesize
\begin{tabularx}{0.95\textwidth}{p{0.2\textwidth}|X}

\textbf{Caso de uso} & Realizar un movimiento \\

\textbf{Precondición} & Iniciar sesión, Unirse a una partida y Conectarse a una
partida \\

\textbf{Escenario general} & \begin{enumerate}
\item El usuario selecciona el origen, el destino del movimiento (el destino
lo controla otro jugador) y el número de tropas con las que va a atacar en la
ventana de la partida.
\item La ventana de la partidas comprueba que el movimiento es legal.
\item La ventana de la partida envía la información al gestor de partidas.
\item El gestor de partidas envía la información al servidor através del proxy.
\item El servidor devuelve la respuesta a la acción de ataque al gestor de
partidas.
\item El gestor de partidas pasa a la ventana de partidas la respuesta.
\item La ventana de la partida pregunta si se acepta la oferta (si no se acepta
el ataque).
\item El usuario elige la acción a realizar.
\item La ventana de la partida envia la acción al gestor de partidas.
\item El gestor de partidas realiza los cálculos de la actualización de la
partida.
\item El gestor de partidas actualiza la ventana de la partida.
\end{enumerate} \\

\textbf{Poscondición} & Se realiza el caso de uso: ''Enviar actualización de la
partida''.\\

\textbf{Escenario alternativo} & Si los territorios seleccionados no están
juntos la aplicación no permitirá realizar la acción.\\

\end{tabularx}
}

\subsection{Responder a acción enemiga}

{\footnotesize
\begin{tabularx}{0.95\textwidth}{p{0.2\textwidth}|X}

\textbf{Caso de uso} & Responder a acción enemiga \\

\textbf{Precondición} & Iniciar sesión, Unirse a una partida y Conectarse a una
partida \\

\textbf{Escenario general} & \begin{enumerate}
\item El servidor envía al gestor de partida la información del ataque del
oponente.
\item El gestor de partidas pasa la información a la ventana de la partida.
\item La ventana de la partida preguna al jugador que acción realizar (aceptar
ataque, dar soldados o dar gallifantes).
\item El usuario elige la acción en la ventana de la partida.
\item La ventana de la partida envía la información al gestor de partidas.
\item El gestor de partidas envía la respuesta al servidor por medio del proxy.

\end{enumerate} \\

\textbf{Poscondición} & Se realiza el caso de uso: ''Recibir actualización de la
partida''. \\

\end{tabularx}
}

\subsection{Comprar refuerzos}

\subsection{Enviar petición de alianza}

\subsection{Responder a petición de alianza}

\subsection{Romper alianza}

\subsection{Enviar actualización de la partida}

\subsection{Recibir actualización de la partida}

\section{Requisitos no funcionales}

\subsection{Estructura lógica de los datos}

\subsubsection{Entidad Datos de registro}
\begin{tabularx}{0.9\textwidth}{llX}
\hline
\textbf{Elemento} & \textbf{Tipo} & \textbf{Descripción} \\
\hline
Nombre & Texto & Nombre del usuario \\
eMail & Texto & Dirección de correo electrónico \\
Contraseña & Texto & Contraseña en el sistema \\
Conf. Contraseña & Texto & Confirmación de contraseña \\
\hline
\end{tabularx}


